---
title: "Untitled"
author: "José Fernando zeea"
date: "3/3/2020"
output: pdf_document
---

```{r}
library(ggplot2)
```


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Sección 2.2

* Solución ejemplo 2.2.1 en R:

Puede desarrollarse el anterior ejemplo de la encuesta de opinión de la siguiente manera:

```{r}
# Introducir los valores:
opinion <- c(1, 0, 0, 1, 1, 3, 1, 3, 1, 3, 0, 0, 0, 3, 0, 0, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1)
opinion <- factor(opinion, labels = c("A favor", "En contra", "NS/NR"))

```

Pueden calcularse las frecuencias aboslutas y relativas  con la funcion table y prop.table como siguen:

```{r}
table(opinion)
```

```{r}
prop.table(table(opinion)) * 100 # En porcentaje
```

Tambien puede calcualarse las frecuencias absolutas acumuladas y las frecuencias absolutas acumuladas haciendo uso de la función cumsum (previo ordenamiento de las frecuencias, aunque en este caso eso no hace falta)

```{r}
cumsum(table(opinion))
```

```{r}
cumsum(prop.table(table(opinion)) * 100)
```

Este resultado se puede ensamblar en un dataframe:

```{r}
categorias <- names(table(opinion)) 
categorias
```

```{r}
# La setentencia as.numeric permite extraer sin los nombres los resultados de las frecuencias.
df_analisisFrec <- data.frame(categorias, frec_abs = as.numeric(table(opinion)), frec_rel = as.numeric(100 * prop.table(table(opinion))), frec_abs_acum = as.numeric(cumsum(table(opinion))), frec_rel_acum = as.numeric(cumsum(100 * prop.table(table(opinion)))))
df_analisisFrec
```

Existen diferentes paquetes que proveen funciones automáticas que generan el análisis anterior en una o pocas líneas, por ejemplo los paquetes janitor, sjPlot o el paquete questionr que se presenta a continuación:

```{r, message=FALSE, warning=FALSE}
library(questionr) # Instalar este paquete si no de dispone
df_analisisFrec <- freq(opinion, cum = TRUE, sort = "dec", total = TRUE)
df_analisisFrec
```

Con la función freq del paquete questionr se redujo el esfuerzo de cosntruir paso a paso el análisis, sin embargo en determinadas situaciones el uso de funciones como table o prop.table es suficiente.

* Solución ejemplo 2.2.1 en R:

Puede desarrollarse el ejemplo haciendo uso de la función freq directamente:

```{r}
# Lectura de los datos
nivel_educativo <- c("B", "D", "M", "B", "B", "P", "B", "M", "B", "B", "B", "P", 
"B", "M", "B", "B", "M", "B", "M", "B", "B", "B", "B", "B", "B", 
"B", "P", "B", "B", "B", "B", "M", "B", "P", "B", "B", "M", "B", 
"B", "B", "D", "B", "M", "B", "P", "B", "B", "B", "P", "P")
library(questionr) # Instalar este paquete si no de dispone
df_analisisFrec2 <- freq(nivel_educativo, cum = TRUE, sort = "dec", total = TRUE)
df_analisisFrec2
```

* Solución ejemplo 2.2.3 en R: en este ejemplo a diferencia del anterior se disponen de dos variables cualitativas, el objetivos será encontrar como es la distribución de la afectividad según cada uno de los tamaños de los caninos. 

```{r}
# Se lee la información la cual se dispone en una columna para la raza, otro para el tamaño de la respectiva raza y su afectividad.
perros <- data.frame(Raza = c("bass", "beau", "boxe", "buld", "bulm", "cani", "chih", "cock", "coll", "dalm", 
         "dobe", "dogo", "foxh", "foxt", "galg", "gasc", "labr", "masa", "mast", "peki", "podb", 
        "podf", "poin", "sett", "stbe", "teck", "tern"), 
Tam = c("Peq", "Gra", "Med", "Peq", "Gra", "Peq", "Peq", "Med", "Gra", "Med", 
        "Gra", "Gra", "Gra", "Peq", "Gra", "Gra", "Med", "Gra", "Gra", 
        "Peq", "Med", "Gra", "Gra", "Gra", "Gra", "Peq", "Gra"),
Afect = c("Baja", "Alta", "Alta", "Alta", "Baja", "Alta", "Alta", "Alta", "Alta", 
          "Alta", "Baja", "Baja", "Baja", "Alta", "Baja", "Baja", "Alta", "Alta", "Baja", "Alta", 
          "Alta", "Baja", "Baja", "Baja", "Baja", "Alta", "Baja"))
# Se imprime las seis primeras filas:
head(perros)
```

Con la función table se puede establecer un conteo de los perros según su tamaño y afectividad, a esta tabla mostrada se le conoce como tabla de contingencia:
```{r}
table(datos$Tam, datos$Afect)
```

Se analiza como se distribuye los perros según su tamaño y afectividad, posteriormente se abordarán análisis más especializados para cuando se dispone dos variables cualitativas:

```{r}
prop.table(table(datos$Tam, datos$Afect)) * 100
```

Predominan los perros grandes con baja afectividad en esta población de caninos.


Ejemplo 2.2.4: las ganancias de una empresa local:

```{r}
ganncias <- c(103.1, 82.1, 106.2, 100.9, 91.8, 96.1, 126.9, 119.8, 93.1, 
86.8, 75.2, 93, 82.3, 94.8, 64.2, 105.3, 108, 86.3, 81.8, 138.1, 
92.5, 66.3, 66.6, 142.2, 96.5, 74.8, 95.4, 100.1, 81.9, 112, 
116.8, 103.2, 66.1, 60.4, 78.7)
num_clase <- ceiling(sqrt(length(ganancias)))
num_clase2 <- ceiling(1+log(length(ganancias), 2))
rango <- max(ganncias) - min(ganancias)
cat("Número de clases regla de la raiz")
num_clase
cat("\n")
cat("Número de clases regla de Sturges")
num_clase2
```

Para este ejemplo, se hará uso de la regla de la raiz (6 clases), se deja al lector coomo ejercicio la replicación del anterior ejemplo con 7 clases:


```{r}
ancho <- rango / num_clase
ancho
```

Construiremos las clases paso paso para el histograma, utilizaremos para tal fin la función cut:


```{r}
cortes <- seq(from = min(ganancias), to = max(ganancias), by = ancho)
clases <- cut(ganancias, breaks = cortes, include.lowest = T, right = F)
clases
```

```{r}
freq(clases, cum = TRUE, total = TRUE)

```


# Visualización de datos

La visualización de datos se puede realizar en R con funciones de diferentes paquetes, entre ellos de la librería base y ggplot2, este último quizá el pquete más popular para elaborar gráficas estadísticas.

* Ejemplo 2.3.3


```{r}
num_hijos <- c(1, 2, 3, 4)
frecuencia <- c(10, 50, 20, 10)
plot(num_hijos, frecuencia, type = "h", col = "blue")
points(num_hijos, frecuencia, pch = 16, col="darkred")
```
Es más conveniente tener las frecuencias exacamente en los valores del eje x que ocurren, además es más util representar en el eje y las frecuencias relativas:


```{r}
plot(num_hijos, frecuencia, type = "h", col = "blue", xaxt="n")
axis(1, at  = num_hijos, col.ticks = NA)
points(num_hijos, frecuencia, pch = 16, col="darkred")
```


Es más frecuente que los datos anteriores estén dispuestos en una base de datos

```{r}
num_hijos <- c(1, 2, 3, 4)
frecuencia <- c(10, 50, 20, 8)
datos <- data.frame(num_hijos, frecuencia)
datos <- datos[rep(row.names(datos),frecuencia),] 
row.names(datos) <- NULL
head(datos)
```

```{r}
datos[rep(row.names(datos),frecuencia)]
```

Se puede visualizar las frecuencias abosultas a partir del conteol número de hijos:

```{r}
ggplot(datos, aes(x =  num_hijos)) + geom_bar()
```


La frecuencia relativa del número de hijos también puede calcularse:

```{r}

ggplot(datos, aes(x =  num_hijos)) + geom_bar(aes(y = 100 * (..count..)/sum(..count..))) + xlab("Número de hijos") + ylab("Frecuencias")
```

